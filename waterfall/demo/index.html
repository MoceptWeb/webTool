<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Voting</title>
  <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <div class="wrap">
      <header>
        <div class="title">
          <h1>{{$活动名称}}</h1>
          <span class="arraw">&nbsp;</span>
        </div>
        <img src="img/wap_background.png" alt="" style="width:100%;height:auto">
      </header>

      <section class="main-content">
        <ul id="flow-box">
<!--            <li>
              <span class="order">{{$顺序}}</span>
              <img src="{{$展品图片}}" />
              <p class="box-title">{{$展品名称}}}</p>
              <p class="box-desc">{{$展品描述}}</p>
              <p class="box-support">支持：{{$支持数}}</p>
            </li>-->
            <!--单图-->
            <li class='result-single'>
              <span class="box-order">{{$顺序}}</span>
              <img src="{{$展品图片}}" />
              <p class="box-support">支持：{{$支持数}}</p>
            </li>
            <!-- 纯文字 -->
            <li class='result-text'>
              <span class="box-order">{{$顺序}}</span>
              <p class="box-title">{{$展品名称}}}</p>
              <p class="box-desc">{{$展品描述}}</p>
              <p class="box-support">支持：{{$支持数}}</p>
            </li>
            <!-- 多图 -->
            <li>
                <span class="box-order">{{$顺序}}</span>
                <img src="{{$展品图片}}" />
                <p class="box-title">{{$展品名称}}}</p>
                <p class="box-desc">{{$展品描述}}</p>
                <p class="box-support">支持：{{$支持数}}</p>
            </li>

           <li class="result-text">
             <span class="box-order">4</span>
              <p class="box-title">4sss</p>
              <p class="box-desc">sss</p>
              <p class="box-support">支持：1200</p>
            </li>

            <li class='result-text'>
              <span class="box-order">6</span>
              <p class="box-title">支支持支持持支持支持持支持支持支支持支持持支持支持持支支持支持持支持支持持支持支持支支持支持持支持支持持支持支持支支持支持持支持支持持支持支持支持支持支支持支持持支持支持持支持支持</p>
              <p class="box-desc">sss支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122</p>
              <p class="box-support">支持：1200</p>
            </li>

            <li class='result-single'>
              <span class="box-order">7</span>
              <img src="http://dummyimage.com/640x3:1" />
              <p class="box-support">支持：122</p>
            </li>

            <li class='result-text'>
              <span class="box-order">8</span>
              <p class="box-title">支持支持支持支持</p>
              <p class="box-desc">sss支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122支持：122</p>
              <p class="box-support">支持：1200</p>
            </li>

            <li>
              <span class="box-order">9</span>
              <img src="http://dummyimage.com/640x3:3" />
              <p class="box-title">3sss</p>
              <p class="box-desc">sss</p>
              <p class="box-support">支持：122</p>
            </li>
           <li>
              <span class="box-order">10</span>
              <img src="http://dummyimage.com/640x3:2" />
              <p class="box-title">5sss</p>
              <p class="box-desc">sss</p>
              <p class="box-support">支持：122</p>
            </li>

            <li>
              <span class="box-order">11</span>
              <img src="http://dummyimage.com/640x3:3" />
              <p class="box-title">6sss</p>
              <p class="box-desc">sss</p>
              <p class="box-support">支持：122</p>
            </li>

            <li>
              <span class="box-order">12</span>
              <img src="http://dummyimage.com/640x3:2" />
              <p class="box-title">7sss</p>
              <p class="box-desc">sss</p>
              <p class="box-support">支持：122</p>
            </li>
        </ul>
      </section>

     <footer>
        <p>2008-{{$现在的年份}} NetDragon Websoft Inc.</p>
      </footer>
    </div>
</body>
<script>
if(getClientWidth() > 640 || !(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))){
  //图片加载完成后执行
  window.onload = function() {flow(10, 10)};
}

function flow(mh, mv) {//参数mh和mv是定义数据块之间的间距，mh是水平距离，mv是垂直距离
    var ul = document.getElementById("flow-box");
    // var w = document.documentElement.offsetWidth;//计算页面宽度
    var w = ul.offsetWidth;//计算li宽度
    var li = ul.getElementsByTagName("li");
    var iw = li[0].offsetWidth + mh;//计算数据块的宽度
    var c = Math.floor(w / iw);//计算列数
    // ul.style.width = iw * c - mh + "px";//设置ul的宽度至适合便可以利用css定义的margin把所有内容居中

    var liLen = li.length;
    var lenArr = [];
    for (var i = 0; i < liLen; i++) {//遍历每一个数据块将高度记入数组
        lenArr.push(li[i].offsetHeight);
    }

    var oArr = [];
    for (var i = 0; i < Math.min(liLen, c); i++) {//把第一行排放好，并将每一列的高度记入数据oArr
        li[i].style.top = "0";
        li[i].style.left = iw * i + "px";
        li[i].style.opacity = "1";
        li[i].style["-moz-opacity"] = "1";
        li[i].style["filter"] = "alpha(opacity=100)";
        oArr.push(lenArr[i]);
    }

    for (var i = c; i < liLen; i++) {//将其他数据块定位到最短的一列后面，然后再更新该列的高度
        var x = _getMinKey(oArr);//获取最短的一列的索引值
        li[i].style.top = oArr[x] + mv + "px";
        li[i].style.left = iw * x + "px";
        li[i].style.opacity = "1";
        li[i].style["-moz-opacity"] = "1";
        li[i].style["filter"] = "alpha(opacity=100)";
        oArr[x] = lenArr[i] + oArr[x] + mv;//更新该列的高度
    }

    if(isScroll().scrollY){
      document.getElementsByTagName('footer')[0].style.position= 'static';
      document.getElementsByTagName('footer')[0].style.margin= '2rem auto 0 auto';
      document.getElementById('flow-box').style.height = (getScrollHeight() - document.getElementsByTagName('header')[0].offsetHeight -27) + 'px';
    }else{
      // document.getElementsByTagName('footer')[0].style.position= 'absolute';
      // document.getElementsByTagName('footer')[0].style.margin= '0 0 0 -15rem';
      // document.getElementsByTagName('footer')[0].style.bottom= '0';
      // document.getElementsByTagName('footer')[0].style.left= '50%';
    }
}

//改变窗口大小时重新布局
/**
var re;
window.onresize = function() {
    clearTimeout(re);
    re = setTimeout(function() {flow(10, 10);}, 200);
}
*/
//追加项
function _addItem(arr, callback) {
    var _html = "";
    var a = 0;
    var l = arr.length;
    (function loadimg() {
        var img = new Image();
        img.onload = function() {
            a += 1;
            if (a == l) {
                for (var k in arr) {
                    var img = new Image();
                    img.src = arr[k].img;
                    _html += '<li><img src="' + arr[k].img + '" /><a href="#">' + arr[k].title + '</a></li>';
                }
                _appendhtml(document.getElementById("flow-box"), _html);
                callback();
            }
            else {
                loadimg();
            }
        }
        img.src = arr[a].img;
    })()
}

//追加html
function _appendhtml(parent, child) {
    if (typeof (child) == "string") {
        var div = document.createElement("div");
        div.innerHTML = child;
        var frag = document.createDocumentFragment();
        (function() {
            if (div.firstChild) {
                frag.appendChild(div.firstChild);
                arguments.callee();
            }
            else {
                parent.appendChild(frag);
            }
        })();
    }
    else {
        parent.appendChild(child);
    }
}
//获取数字数组的最大值
function _getMaxValue(arr) {
    var a = arr[0];
    for (var k in arr) {
        if (arr[k] > a) {
            a = arr[k];
        }
    }
    return a;
}
//获取数字数组最小值的索引
function _getMinKey(arr) {
    var a = arr[0];
    var b = 0;
    for (var k in arr) {
        if (arr[k] < a) {
            a = arr[k];
            b = k;
        }
    }
    return b;
}
// 文档内容实际高度
function getScrollHeight()
{
    return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
}
// 获取窗口宽度
function getClientWidth(){
  if (window.innerWidth)
winWidth = window.innerWidth;
else if ((document.body) && (document.body.clientWidth))
winWidth = document.body.clientWidth;
return winWidth
}
//取窗口可视范围的高度
function getClientHeight()
{
    var clientHeight=0;
    if(document.body.clientHeight&&document.documentElement.clientHeight)
    {
        var clientHeight = (document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
    }
    else
    {
        var clientHeight = (document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
    }
    return clientHeight;
}
// 获取滚动条
function isScroll(el) {
   // test targets
   var elems = el ? [el] : [document.documentElement, document.body];
   var scrollX = false, scrollY = false;
   for (var i = 0; i < elems.length; i++) {
     var o = elems[i];
     // test horizontal
     var sl = o.scrollLeft;
     o.scrollLeft += (sl > 0) ? -1 : 1;
     o.scrollLeft !== sl && (scrollX = scrollX || true);
     o.scrollLeft = sl;
     // test vertical
     var st = o.scrollTop;
     o.scrollTop += (st > 0) ? -1 : 1;
     o.scrollTop !== st && (scrollY = scrollY || true);
     o.scrollTop = st;
   }
   // ret
   return {
     scrollX: scrollX,
     scrollY: scrollY
   };
 };
</script>
</html>


<!--
todo
1、wap header和main的背景图如何无缝衔接
2、wap中main的li的宽度是相对于谁啊
3、pc端的最小宽度
4、根据宽度而不是设备采用不同布局
5、奖牌1， 2， 3原始顺序去掉

瀑布流最后一列的padding-right
-->
